#+TITLE: dired
#+setupfile: ../setup.org

#+begin_src emacs-lisp :comments no :padline no
;;; toncs-config-dired.el -*- lexical-binding: t -*-
#+end_src

本来は明示的に ~dired~ を呼ぶまではロードされないはずだから、
こういう風にファイルを分けておくのは良いことなのだけれど、
~el-get-core~ が ~(require 'dired)~ してしまっているので、起動時には必ずロードされてしまっている…。

#+begin_src emacs-lisp
(require 'dired)
(require 'org-download)
(require 'general)
(require 'dirvish)
(require 'embark)

(defun toncs-config-dired-configure ()
  (setq dired-dwim-target t)
  (setq dired-recursive-deletes 'always)
  (setq delete-by-moving-to-trash t)
  (defvar dired-bind-jump nil) ; 何かの拍子に dired-x ロードされても、 C-x C-j は SKK の為に取っておきたい
  (let ((gls (executable-find "gls")))
    (when gls
      (setq insert-directory-program gls)))
  (setq dired-listing-switches "-AGhlv --group-directories-first --time-style=long-iso")
  (diredfl-global-mode)

  (dirvish-override-dired-mode 1)
  (dirvish-peek-mode 1)
  (setq dirvish-attributes '(all-the-icons file-size))

  (general-def dired-mode-map
    "SPC" #'dirvish-show-history
    "f" #' dirvish-file-info-menu
    "r"  #'wdired-change-to-wdired-mode
    "N" #'dired-narrow
    "TAB" #'dired-subtree-toggle
    "M-a" #'dirvish-mark-actions-menu
    "M-s" #'dirvish-setup-menu
    "M-c" #'dired-collapse-mode
    "M-f" #'dirvish-toggle-fullscreen
    [remap dired-summary] #'dirvish-dispatch
    [remap dired-do-copy] #'dirvish-yank
    [remap mode-line-other-buffer] #'dirvish-other-buffer)
  (general-def
    "<f12>" #'dirvish)

  (add-hook 'dired-mode-hook #'org-download-enable))
#+end_src

#+begin_src emacs-lisp :comments no
(provide 'toncs-config-dired)
;;; toncs-config-dired.el ends here
#+end_src
